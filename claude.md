# 信号機風インタラクティブビジュアライゼーション

## 概要
Next.js + p5.jsで作成した信号機のようなインタラクティブなビジュアライゼーションアプリケーション。3つの円形パターン（青・黄・赤）が横並びに配置され、キー操作で点灯する色を切り替えることができます。

## 主な機能

### 1. 3色の信号機レイアウト
- **左**: 青（Blue）
- **中央**: 黄色（Yellow）
- **右**: 赤（Red）

### 2. キーボード操作
- `r` キー: 赤を点灯
- `y` キー: 黄色を点灯
- `b` キー: 青を点灯

同時に点灯するのは1色のみで、非アクティブな色は暗いグレー（RGB: 30, 30, 30）で表示されます。

### 3. 適応的なレイアウト
- **アクティブな円**: 画面高さ100%の正円として表示
- **非アクティブな円**: 残りのスペースを2等分して横方向に圧縮
- 画面幅に応じて自動的に配置が調整され、重なりが発生しない

### 4. パラメータ調整
3つのスライダーで円形パターンをカスタマイズ可能:
- **Layers** (3-20): 同心円状のレイヤー数
- **Radius** (5-50): 各小円の半径
- **Spacing Factor** (1.0-2.0): 小円同士の間隔

## 技術仕様

### アーキテクチャ
```
app/
├── page.tsx              # ルートページ（全画面表示）
├── components/
│   └── P5Canvas.tsx      # p5.jsスケッチのReactラッパー
├── globals.css
└── layout.tsx
```

### 実装の特徴

#### 1. 円形パターン生成アルゴリズム (`app/components/P5Canvas.tsx:85-129`)
```typescript
function drawPattern(
  pg: p5,
  centerX: number,
  centerY: number,
  allocatedWidth: number,
  color: 'blue' | 'yellow' | 'red',
  isActive: boolean
)
```

- 同心円状に小円を配置
- 各レイヤーで円周に応じた適切な個数の小円を計算
- 隣接レイヤーで小円を互い違いに配置（角度オフセット）
- 非アクティブ時は配置のみ横方向に圧縮、小円自体は正円を維持

#### 2. 画面分割ロジック (`app/components/P5Canvas.tsx:60-80`)
```typescript
const activeCircleWidth = p.height;
const remainingWidth = p.width - activeCircleWidth;
const inactiveCircleWidth = remainingWidth / 2;
```

- アクティブな円に画面高さ分の幅を確保
- 残りスペースを2つの非アクティブな円で等分
- 左から順に配置し重なりを防ぐ

#### 3. カラーマッピング (`app/components/P5Canvas.tsx:99-109`)
- **Blue**: RGB(0, 150, 255)
- **Yellow**: RGB(255, 220, 0)
- **Red**: RGB(255, 50, 50)
- **Inactive**: RGB(30, 30, 30)

## 使用方法

### 開発サーバーの起動
```bash
npm run dev
```

ブラウザで `http://localhost:3000` にアクセス

### インタラクション
1. スライダーでパターンを調整
2. キーボードの `r`, `y`, `b` で点灯色を切り替え
3. ブラウザウィンドウのリサイズに自動対応

## 依存関係
- Next.js 15.1.4
- React 19
- p5.js 1.11.2
- TypeScript

## デザインノート

### なぜこの実装？
1. **正円の小円を維持**: 非アクティブパターンでも小円は変形させず、配置のみ圧縮することで視認性を保持
2. **適応的レイアウト**: アクティブな円が常に正円で表示されるよう、動的に画面を3分割
3. **noLoop()使用**: 静的な描画のためパフォーマンスを最適化し、必要時のみredraw()

### パフォーマンス最適化
- `noLoop()` でアイドル時のCPU使用を抑制
- スライダー変更検知による必要最小限の再描画
- TypeScriptによる型安全性の確保
